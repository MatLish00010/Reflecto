# Система логина через код приглашения

## Обзор

Система использует логин через код приглашения. Вы создаете пользователя и код приглашения в базе данных, а пользователь просто вводит код для входа.

## Структура базы данных

### Таблица `users`

- `id` - уникальный идентификатор
- `created_at` - дата создания

### Таблица `invites`

- `id` - уникальный идентификатор
- `code` - код приглашения (уникальный)
- `user_id` - ссылка на пользователя (обязательно)
- `created_at` - дата создания
- `used_at` - дата использования (null если не использован)

## Как создать пользователя и приглашение

### 1. Создайте пользователя:

```sql
INSERT INTO users (created_at) VALUES (NOW());
```

### 2. Создайте код приглашения для этого пользователя:

```sql
INSERT INTO invites (code, user_id, created_at)
VALUES ('ABC12345', 1, NOW());
```

Где `1` - это ID созданного пользователя.

## Как работает система

1. **Вы создаете пользователя и код** → в базе данных
2. **Пользователь заходит на сайт** → автоматически редиректится на `/login`
3. **Вводит код приглашения** → система проверяет код
4. **Если код валидный** → пользователь входит в систему, код помечается как использованный
5. **Пользователь редиректится на главную страницу**
6. **При следующих посещениях** → автоматический вход по сохраненному ID

## API Endpoints

### POST /api/login

Принимает код приглашения.

**Request:**

```json
{
  "code": "ABC12345"
}
```

**Response:**

```json
{
  "user": {
    "id": 1,
    "created_at": "2024-01-01T00:00:00Z"
  }
}
```

### GET /api/user/[id]

Получает данные пользователя по ID.

## Безопасность

- Коды приглашений одноразовые
- После использования код помечается как `used_at`
- Пользователи не могут получить доступ без валидного кода
- ID пользователя сохраняется в localStorage
- Код должен быть привязан к существующему пользователю

## Файлы системы

- `src/app/[lang]/login/page.tsx` - страница логина
- `src/components/login-form.tsx` - форма логина
- `src/hooks/use-auth.ts` - хуки для логина/логаута
- `src/hooks/use-user.ts` - хук для получения данных пользователя
- `src/middleware.ts` - проверка авторизации и редиректы
